-- Drop existing tables if they exist (from previous assignments)
-- Drop in reverse order due to foreign key constraints
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE reactions CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE comments CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE posts CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/
BEGIN
  EXECUTE IMMEDIATE 'DROP TABLE users CASCADE CONSTRAINTS';
EXCEPTION WHEN OTHERS THEN NULL;
END;
/

-- Create USERS table
CREATE TABLE users (
  user_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  username VARCHAR2(50) UNIQUE NOT NULL,
  created_at TIMESTAMP DEFAULT SYSDATE
);

-- Create POSTS table
CREATE TABLE posts (
  post_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  user_id NUMBER NOT NULL,
  text VARCHAR2(500) NOT NULL,
  created_at TIMESTAMP DEFAULT SYSDATE,
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);

-- Create COMMENTS table
CREATE TABLE comments (
  comment_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  post_id NUMBER NOT NULL,
  user_id NUMBER NOT NULL,
  text VARCHAR2(500) NOT NULL,
  created_at TIMESTAMP DEFAULT SYSDATE,
  FOREIGN KEY (post_id) REFERENCES posts(post_id),
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);

-- Create REACTIONS table (for likes)
CREATE TABLE reactions (
  reaction_id NUMBER GENERATED BY DEFAULT AS IDENTITY PRIMARY KEY,
  post_id NUMBER NOT NULL,
  user_id NUMBER NOT NULL,
  reaction_type VARCHAR2(20) DEFAULT 'like',
  created_at TIMESTAMP DEFAULT SYSDATE,
  FOREIGN KEY (post_id) REFERENCES posts(post_id),
  FOREIGN KEY (user_id) REFERENCES users(user_id)
);

-- Add sample users
INSERT INTO users VALUES (1, 'STUDENT 1', SYSDATE);
INSERT INTO users VALUES (2, 'STUDENT 2', SYSDATE);
INSERT INTO users VALUES (3, 'STUDENT 3', SYSDATE);
INSERT INTO users VALUES (4, 'STUDENT 4', SYSDATE);

-- Add sample posts
INSERT INTO posts VALUES (1, 1, 'WECIB is the best!', SYSDATE - 1);
INSERT INTO posts VALUES (2, 2, 'I know, right?!?!?', SYSDATE - 0.5);
INSERT INTO posts VALUES (3, 3, 'I never want to leave!', SYSDATE);
INSERT INTO posts VALUES (4, 1, '67', SYSDATE);

-- Add sample comments
INSERT INTO comments VALUES (1, 1, 2, 'Nice post!', SYSDATE - 0.5);
INSERT INTO comments VALUES (2, 1, 3, 'I agree!', SYSDATE - 0.4);
INSERT INTO comments VALUES (3, 2, 1, 'Cool!', SYSDATE - 0.3);

-- Add sample likes
INSERT INTO reactions VALUES (1, 1, 2, 'like', SYSDATE - 0.5);
INSERT INTO reactions VALUES (2, 1, 3, 'like', SYSDATE - 0.4);
INSERT INTO reactions VALUES (3, 1, 4, 'like', SYSDATE - 0.35);
INSERT INTO reactions VALUES (4, 2, 1, 'like', SYSDATE - 0.3);
INSERT INTO reactions VALUES (5, 3, 1, 'like', SYSDATE - 0.2);
INSERT INTO reactions VALUES (6, 4, 2, 'like', SYSDATE - 0.1);